# Copilot Instructions for convert2mermaid

## Project Overview

convert2mermaid is a Node.js CLI tool that converts diagrams from various formats into Mermaid.js syntax. The tool currently supports Visio (.vsdx) files and is designed to be extensible for other formats like DrawIO and Excalidraw.

## Key Architecture

### Core Components

-   **index.ts**: Main CLI entry point using Commander.js
-   **parser.ts**: Central parser dispatcher that routes to format-specific parsers
-   **scribe.ts**: Converts internal diagram representation to Mermaid syntax
-   **types.d.ts**: Internal data structures for diagrams, shapes, and styles
-   **shapes/flowchartShapes.ts**: Maps shape types to Mermaid shape syntax

### Current File Format Support

-   **Visio (.vsdx)**: Uses the `vsdx-js` npm package (version 1.1.1) âœ…
-   **DrawIO (.drawio)**: XML-based format with custom parser âœ…
-   **Excalidraw (.excalidraw)**: JSON-based format with custom parser âœ…

### Planned File Format Support

-   **Other formats**: Lucidchart, PlantUML, etc.

## Data Flow

1. CLI parses command line arguments
2. `parseData()` routes to appropriate parser based on file extension
3. Format-specific parser converts to internal `Diagram` interface
4. `generateMermaidCode()` converts `Diagram` to Mermaid syntax
5. Output written to .mmd file

## Key Interfaces

### Diagram

```typescript
interface Diagram {
    Shapes: Shape[];
    Settings?: string;
}
```

### Shape

```typescript
interface Shape {
    Id: string;
    ShapeType: string; // Used for Mermaid shape mapping
    Label: string;
    Style: Style;
    IsEdge: boolean;
    FromNode: string; // For edges/connectors
    ToNode: string; // For edges/connectors
}
```

### Style

```typescript
interface Style {
    FillForeground: string;
    FillBackground: string;
    TextColor: string;
    LineWeight: number;
    LineColor: string;
    LinePattern: number;
    Rounding: number;
    BeginArrow: number;
    BeginArrowSize: number;
    EndArrow: number;
    EndArrowSize: number;
    LineCap: number;
    FillPattern: number;
}
```

## External Dependencies

-   **vsdx-js**: Handles Visio file parsing (exports `parseVisioFile`, `VisioFile`, `VisioShape` types)
-   **xml2js**: For XML parsing (used by DrawIO parser)
-   **adm-zip**: For extracting zip-based formats
-   **commander**: CLI argument parsing
-   **figlet**: ASCII art title
-   **ora**: Loading spinners

## Development Guidelines

### Adding New Format Support

1. Create parser in `/src/parser/` directory (e.g., `drawioParser.ts`)
2. Implement conversion from format-specific types to internal `Shape` interface
3. Add case to `parseData()` switch statement in `parser.ts`
4. Add file extension to `supportedFileTypes` array in `index.ts`
5. Add test files and test cases

### Shape Type Mapping

-   Shape types from input formats must be mapped to `ShapeType` strings
-   `getMermaidShapeByValue()` in `flowchartShapes.ts` maps shape types to Mermaid syntax
-   Add new shape mappings as needed for different formats

### Style Handling

-   Different formats may have different style properties
-   Convert format-specific styles to the standard `Style` interface
-   `getStyleStatement()` in `scribe.ts` converts styles to Mermaid CSS

### Testing

-   Use Vitest for testing
-   Add sample files to `/tests/` directory
-   Test both parsing and Mermaid output generation

## Current Status

-   âœ… Visio (.vsdx) support working with vsdx-js v1.1.1
-   âœ… DrawIO (.drawio) support implemented with custom XML parser
-   âœ… Excalidraw (.excalidraw) support implemented with JSON parser
-   ðŸ”„ Additional formats and enhancements planned

## Build & Run

```bash
npm run build
node ./dist/index.js -i <inputfile> [-o <outputfile>] [-d flowchart] [-f mmd]
```
